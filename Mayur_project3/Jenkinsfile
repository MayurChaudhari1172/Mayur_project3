pipeline {
    agent any

    environment {
        TF_WORKING_DIR = 'Mayur_project3/Application/alb_with_asg'  // âœ… Your actual folder path
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', url: 'https://github.com/MayurChaudhari1172/Mayur_project3.git'
            }
        }

        stage('Terraform Init') {
            steps {
                dir("${TF_WORKING_DIR}") {
                    sh 'terraform init'
                }
            }
        }

        stage('Terraform Import') {
            steps {
                dir("${TF_WORKING_DIR}") {
                    sh '''
                        terraform import "module.alb.aws_lb.this" arn:aws:elasticloadbalancing:us-east-1:183295447311:loadbalancer/app/FQTS-alb-app/c7418bddba06c076 || true
                        terraform import "module.alb.aws_lb_target_group.frontend_tg" arn:aws:elasticloadbalancing:us-east-1:183295447311:targetgroup/FQTS-alb-app-frontend/20c4e1da65322a39 || true
                        terraform import "module.alb.aws_lb_target_group.backend_tg" arn:aws:elasticloadbalancing:us-east-1:183295447311:targetgroup/FQTS-alb-app-backend/9ec3b45ef5df77b8 || true
                    '''
                }
            }
        }

        stage('Terraform Plan') {
            steps {
                dir("${TF_WORKING_DIR}") {
                    sh 'terraform plan -var-file="dev.tfvars"'
                }
            }
        }

        stage('Terraform Apply') {
            steps {
                dir("${TF_WORKING_DIR}") {
                    sh 'terraform apply -auto-approve -var-file="dev.tfvars"'
                }
            }
        }
    }
}
